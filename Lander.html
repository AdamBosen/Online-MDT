<!doctype html>
<html>

<head>
	<script src="jatos.js"></script>
	<script src="jspsych-7.2.1-dist/jspsych.js"></script>
	<script src="jspsych-7.2.1-dist/plugin-survey-text.js"></script>
	<link href="jspsych-7.2.1-dist/jspsych.css" rel="stylesheet" type="text/css"></link>
	<link href="css/3AFC.css" rel="stylesheet" type="text/css"></link>
</head>

<body></body>

<script>

	var timeline = [];
	
	var jsPsych = initJsPsych({
		on_finish: function() {
			jatos.submitResultData(jsPsych.data.get());
			jatos.studySessionData.SubjectID = jsPsych.data.get().last().trials[0].response.SubjectID;
			//Get the JSON input for the link that loaded this page to point to the correct component,
			//Then build a queue of tasks to perform
			if(jatos.batchJsonInput.task == 'SMDT') {
				//The batch link defines the number of runs in the task.
				//Participants usually do 3 runs, but if this number is undefined we'll just do one
				//SMDT is component 2
				if(jatos.batchJsonInput.nRuns === undefined) {
					jatos.studySessionData.nRunsRemaining = 1;
				} else {
					jatos.studySessionData.nRunsRemaining = jatos.batchJsonInput.nRuns;
				}
				//SMDT is component 2
				jatos.startComponentByPos(2);

			}
			else if(jatos.batchJsonInput.task == 'AMDT') {
				//AMDT is component 3
			}
			else {
				//I'm not sure what task should be run
				jatos.endStudy(jsPsych.data.get().json());
			}
		}
	});

	var enterSubjectID = {
		type: jsPsychSurveyText,
		questions:[{prompt: "Please enter your participant ID", name: 'SubjectID'}],
		button_label: 'Log in'
	}

	timeline.push(enterSubjectID);

	jatos.onLoad(() => {
		jsPsych.run(timeline);
	});

</script>

</html>

